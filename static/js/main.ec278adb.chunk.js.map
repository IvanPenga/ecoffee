{"version":3,"sources":["components/login/Login.jsx","components/user/User.jsx","components/user/UserList.jsx","pages/Home.jsx","pages/App.jsx","reportWebVitals.js","index.js","components/user/index.module.scss","components/login/index.module.scss"],"names":["Login","onLogin","useState","nickname","setNickname","className","styles","login","TextField","onChange","e","target","value","variant","label","Button","onClick","color","User","id","onCall","user","UserList","users","userlist","map","connection","RTCPeerConnection","iceServers","urls","Home","socket","localVideoRef","useRef","remoteVideoRef","offer","setOffer","callerId","setCallerId","setUsers","stream","setStream","useEffect","queue","on","console","log","setRemoteDescription","RTCSessionDescription","then","forEach","candidate","answer","a","RTCIceCandidate","addIceCandidate","ontrack","current","srcObject","streams","open","navigator","mediaDevices","getUserMedia","audio","video","handleOnCall","onicecandidate","emit","getTracks","track","addTrack","createOffer","offerToReceiveAudio","offerToReceiveVideo","setLocalDescription","handleAnswer","createAnswer","ref","autoPlay","playsInline","App","setSocket","localStorage","getItem","process","socketIOClient","withCredentials","extraHeaders","setItem","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","require","config","ReactDOM","render","StrictMode","document","getElementById","module","exports"],"mappings":"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","file":"static/js/main.ec278adb.chunk.js","sourcesContent":["import styles from './index.module.scss';\nimport { Button, TextField } from '@material-ui/core';\nimport React, { useState } from 'react';\n\nconst Login = ({ onLogin }) => {\n\n  const [nickname, setNickname] = useState();\n\n  const handleOnChange = (e) => {\n    setNickname(e.target.value);\n  };\n\n  const handleOnLogin = () => {\n    onLogin && onLogin(nickname);\n  };\n\n  return (\n    <div className={styles.login}>\n      <TextField onChange={handleOnChange} variant=\"standard\" label=\"Enter your nickname\" />\n      <Button onClick={handleOnLogin} variant=\"contained\" color=\"primary\">Enter</Button>\n    </div>\n  );\n}\n\nexport default Login;","import styles from './index.module.scss';\n\nconst User = ({ id, nickname, onCall }) => {\n  return (\n    <div className={styles.user}>\n      <p>Nickname - {id}</p>\n      <p>{nickname}</p>\n      <button onClick={() => onCall(id)}>Make call</button>\n    </div>\n  );\n}\n\nexport default User;\n","import User from \"./User\";\nimport styles from './index.module.scss';\n\nconst UserList = ({ users, onCall }) => {\n  return (\n    <div className={styles.userlist}>\n      {users.map((user) => <User key={user.id} {...user} onCall={onCall} />)}\n    </div>\n  );\n}\n\nexport default UserList;","import { useEffect, useRef, useState } from \"react\";\nimport UserList from \"../components/user/UserList\";\n\nconst connection = new RTCPeerConnection({\n  iceServers: [{urls: \"stun:stun.1.google.com:19302\"}]\n});\n\nconst Home = ({ nickname, socket }) => {\n\n  const localVideoRef = useRef();\n  const remoteVideoRef = useRef();\n\n  const [offer, setOffer] = useState();\n  const [callerId, setCallerId] = useState();\n  const [users, setUsers] = useState([]);\n\n  const [stream, setStream] = useState();\n\n  useEffect(() => {\n\n    const queue = [];\n\n    socket?.on('welcome', (users) => setUsers(users));\n    socket?.on('offer', ({ offer, callerId }) => {\n      console.log('Recieve offer', offer, callerId); \n      setOffer(offer); \n      setCallerId(callerId); \n      connection.setRemoteDescription(new RTCSessionDescription(offer))\n        .then(() => {\n          console.log('Remote description is set');\n          queue.forEach(candidate => {\n\n          });\n        });\n    });\n    socket?.on('answer', (answer) => {\n      console.log('Recieve answer', new RTCSessionDescription(answer)); \n      connection.setRemoteDescription(new RTCSessionDescription(answer));\n    });\n    socket?.on('icecandidate', async (candidate) => {\n      console.log('Adding ICE candidate...', new RTCIceCandidate(candidate));\n      connection.addIceCandidate(new RTCIceCandidate(candidate));\n    });\n\n\n\n\n    connection.ontrack = (e) => {\n      console.log(\"Answer got some connection \");\n       if (remoteVideoRef.current.srcObject !== e.streams[0]) {\n        remoteVideoRef.current.srcObject = e.streams[0];\n       }\n    }\n\n\n\n\n  }, [socket]);\n\n  const open = async () => {\n    const stream = await navigator.mediaDevices.getUserMedia({ audio: false, video: true });\n    setStream(stream);\n    localVideoRef.current.srcObject = stream;\n  }\n\n  const handleOnCall = (async (id) => {\n\n\n    connection.ontrack = () => {\n      console.log('I got some tracks!');\n    };\n\n    connection.onicecandidate = (e) => {\n      if (e.candidate) { socket?.emit('icecandidate', { id, candidate: new RTCIceCandidate(e.candidate) }); }\n    }\n\n    stream.getTracks().forEach(track => connection.addTrack(track, stream));\n\n    const offer = await connection.createOffer({ offerToReceiveAudio: true, offerToReceiveVideo: true });\n\n\n\n    socket?.emit('offer', { id, offer}, () => {\n      console.log('Offer callback');\n    });\n    \n\n    connection.setLocalDescription(offer);\n\n\n      \n  });\n\n  const handleAnswer = (async() => {\n\n    connection.onicecandidate = (e) => {\n      if (e.candidate) { socket?.emit('icecandidate', { id: callerId, candidate: new RTCIceCandidate(e.candidate) }); }\n    }\n\n    // connection.ontrack = (e) => {\n    //   console.log(\"Answer got some connection \");\n    //    if (remoteVideoRef.current.srcObject !== e.streams[0]) {\n    //     remoteVideoRef.current.srcObject = e.streams[0];\n    //    }\n    // }\n\n    const answer = await connection.createAnswer();\n\n    socket?.emit('answer', { id: callerId, answer });\n\n    await connection.setLocalDescription(answer);\n\n    \n  });\n\n  return (\n    <div className=\"home\">\n      <UserList users={users} onCall={handleOnCall} />\n      { offer && <button onClick={handleAnswer}>Answer</button> }\n      { callerId && `Caller: ${callerId}` }\n      <video ref={localVideoRef} autoPlay playsInline />\n      <video ref={remoteVideoRef} autoPlay playsInline />\n\n      <button onClick={open}>\n        OPEN\n      </button>\n    </div>\n  );\n}\n\nexport default Home;\n","import { useEffect, useState } from \"react\";\nimport Login from \"../components/login/Login\";\nimport Home from './Home';\nimport socketIOClient from 'socket.io-client';\n\nconst host = process.env.REACT_APP_SIGNALING_SERVER;\n\nconst App = () => {\n\n  const [socket, setSocket] = useState();\n  const [nickname, setNickname] = useState(() => localStorage.getItem('nickname'));\n\n  const handleOnLogin = (nickname) => {\n    localStorage.setItem('nickname', nickname);\n    setNickname(nickname);\n  };\n\n  console.log(process.env);\n\n  useEffect(() => {\n    setSocket(socketIOClient(host, {\n      withCredentials: true,\n      extraHeaders: { 'ecoffee-nickname': nickname }\n    }));\n  }, [nickname]);\n\n  return (\n    <div className=\"App\">\n      { process.env.REACT_APP_SIGNALING_SERVER }\n      { nickname ? <Home nickname={nickname} socket={socket} /> : <Login onLogin={handleOnLogin} /> }\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './pages/App';\nimport reportWebVitals from './reportWebVitals';\nrequire('dotenv').config();\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"user\":\"user_user__CVTWO\",\"userlist\":\"user_userlist__2yMXx\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"login\":\"login_login__HXn3V\"};"],"sourceRoot":""}