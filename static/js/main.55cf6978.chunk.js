(this.webpackJsonpecoffee=this.webpackJsonpecoffee||[]).push([[0],{126:function(e,n,t){},127:function(e,n,t){"use strict";t.r(n);var c=t(0),a=t.n(c),s=t(8),r=t.n(s),_=t(33),i=t(54),o=t(11),u=t(26),l=t.n(u),d=t(157),f=t(158),O=t(53),j=t(4),b=function(e){var n=e.socket,t=Object(c.useState)(),a=Object(o.a)(t,2),s=a[0],r=a[1],u=Object(c.useState)([]),b=Object(o.a)(u,2),m=b[0],p=b[1],v=Object(c.useRef)(),E=Object(c.useRef)(),g=function(){s&&(null===n||void 0===n||n.emit("message",s),p((function(e){return[].concat(Object(i.a)(e),[{message:s,nickname:"You",sender:!0}])})),v.current.value="",r(""))};Object(c.useEffect)((function(){var e;null===(e=E.current)||void 0===e||e.scrollIntoView()}),[m]);var x=Object(c.useCallback)((function(e){"Enter"===e.key&&g()}),[g]),h=Object(c.useCallback)((function(e){var n=e.target;r(n.value)}),[]);return Object(c.useEffect)((function(){var e=function(e){return p((function(n){return[].concat(Object(i.a)(n),[e])}))};return null===n||void 0===n||n.on("message",e),function(){null===n||void 0===n||n.off("message",e)}}),[n]),Object(j.jsxs)("div",{className:l.a.chat,children:[Object(j.jsxs)("div",{className:l.a.messages,children:[m.map((function(e){return Object(j.jsx)(O.a,Object(_.a)({},e))})),Object(j.jsx)("div",{ref:E})]}),Object(j.jsxs)("div",{className:l.a.messageInput,children:[Object(j.jsx)(d.a,{inputRef:v,onChange:h,onKeyDown:x,variant:"outlined",size:"small"}),Object(j.jsx)(f.a,{onClick:g,variant:"contained",color:"primary",children:"Send"})]})]})},m=t(78),p=t.n(m),v=function(e){var n=e.onLogin,t=Object(c.useState)(),a=Object(o.a)(t,2),s=a[0],r=a[1],_=Object(c.useState)(!0),i=Object(o.a)(_,2),u=i[0],l=i[1],O=function(e){return e&&e.length>=1},b=function(){O(s)&&n&&n(s)};return Object(j.jsxs)("div",{className:p.a.login,children:[Object(j.jsx)(d.a,{onKeyDown:function(e){"Enter"===e.key&&b()},onChange:function(e){var n=e.target.value;l(!O(n)),r(n)},variant:"outlined",size:"small",label:"Nickname"}),Object(j.jsx)(f.a,{disabled:u,onClick:b,variant:"contained",color:"primary",children:"Enter"})]})},E=t(19),g=t.n(E),x=t(37),h=t(45),C=t.n(h),k=function(e){var n=e.id,t=e.nickname,c=e.onCall;return Object(j.jsxs)("div",{className:C.a.user,children:[Object(j.jsxs)("p",{children:["Nickname - ",n]}),Object(j.jsx)("p",{children:t}),Object(j.jsx)("button",{onClick:function(){return c(n)},children:"Make call"})]})},D=function(e){var n=e.users,t=e.onCall;return Object(j.jsx)("div",{className:C.a.userlist,children:n.map((function(e){return Object(j.jsx)(k,Object(_.a)(Object(_.a)({},e),{},{onCall:t}),e.id)}))})},P=t(46),M=t.n(P),w=new RTCPeerConnection({iceServers:[{urls:"stun:stun.1.google.com:19302"}]}),R=function(e){e.nickname;var n=e.socket,t=Object(c.useRef)(),a=Object(c.useRef)(),s=Object(c.useState)(),r=Object(o.a)(s,2),_=r[0],i=r[1],u=Object(c.useState)(),l=Object(o.a)(u,2),d=l[0],f=l[1],O=Object(c.useState)([]),m=Object(o.a)(O,2),p=m[0],v=m[1],E=Object(c.useState)(),h=Object(o.a)(E,2),C=h[0],k=h[1];Object(c.useEffect)((function(){var e=[];null===n||void 0===n||n.on("welcome",(function(e){return v(e)})),null===n||void 0===n||n.on("offer",(function(n){var t=n.offer,c=n.callerId;console.log("Recieve offer",t,c),i(t),f(c),w.setRemoteDescription(new RTCSessionDescription(t)).then((function(){console.log("Remote description is set"),e.forEach((function(e){}))}))})),null===n||void 0===n||n.on("answer",(function(e){console.log("Recieve answer",new RTCSessionDescription(e)),w.setRemoteDescription(new RTCSessionDescription(e))})),null===n||void 0===n||n.on("icecandidate",function(){var e=Object(x.a)(g.a.mark((function e(n){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Adding ICE candidate...",new RTCIceCandidate(n)),w.addIceCandidate(new RTCIceCandidate(n));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),w.ontrack=function(e){console.log("Answer got some connection "),a.current.srcObject!==e.streams[0]&&(a.current.srcObject=e.streams[0])}}),[n]);var P=function(){var e=Object(x.a)(g.a.mark((function e(){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:!0});case 2:n=e.sent,k(n),t.current.srcObject=n;case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=Object(x.a)(g.a.mark((function e(t){var c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w.ontrack=function(){console.log("I got some tracks!")},w.onicecandidate=function(e){e.candidate&&(null===n||void 0===n||n.emit("icecandidate",{id:t,candidate:new RTCIceCandidate(e.candidate)}))},C.getTracks().forEach((function(e){return w.addTrack(e,C)})),e.next=5,w.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:c=e.sent,null===n||void 0===n||n.emit("offer",{id:t,offer:c},(function(){console.log("Offer callback")})),w.setLocalDescription(c);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),I=function(){var e=Object(x.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w.onicecandidate=function(e){e.candidate&&(null===n||void 0===n||n.emit("icecandidate",{id:d,candidate:new RTCIceCandidate(e.candidate)}))},e.next=3,w.createAnswer();case 3:return t=e.sent,null===n||void 0===n||n.emit("answer",{id:d,answer:t}),e.next=7,w.setLocalDescription(t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(j.jsxs)("div",{className:M.a.home,children:[Object(j.jsxs)("div",{children:[Object(j.jsx)(D,{users:p,onCall:R}),_&&Object(j.jsx)("button",{onClick:I,children:"Answer"}),d&&"Caller: ".concat(d),Object(j.jsx)("video",{ref:t,autoPlay:!0,playsInline:!0}),Object(j.jsx)("video",{ref:a,autoPlay:!0,playsInline:!0}),Object(j.jsx)("button",{onClick:P,children:"OPEN"})]}),Object(j.jsx)(b,{socket:n})]})},I=t(79),T=t.n(I),L=function(){var e=Object(c.useState)(),n=Object(o.a)(e,2),t=n[0],a=n[1],s=Object(c.useState)((function(){return localStorage.getItem("nickname")})),r=Object(o.a)(s,2),_=r[0],i=r[1];return Object(c.useEffect)((function(){a(T()("https://e-coffee-server.herokuapp.com/",{withCredentials:!0,extraHeaders:{"ecoffee-nickname":_}}))}),[_]),Object(j.jsx)("div",{className:M.a.app,children:_?Object(j.jsx)(R,{nickname:_,socket:t}):Object(j.jsx)(v,{onLogin:function(e){e&&(localStorage.setItem("nickname",e),i(e))}})})},A=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,160)).then((function(n){var t=n.getCLS,c=n.getFID,a=n.getFCP,s=n.getLCP,r=n.getTTFB;t(e),c(e),a(e),s(e),r(e)}))};t(126);r.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(L,{})}),document.getElementById("root")),A()},26:function(e,n,t){e.exports={chat:"chat_chat__16YQr",messageInput:"chat_messageInput__wyxMG",messages:"chat_messages__3Bv-7",message:"chat_message__35AWL",message__sender:"chat_message__sender__31rk4"}},45:function(e,n,t){e.exports={user:"user_user__CVTWO",userlist:"user_userlist__2yMXx"}},46:function(e,n,t){e.exports={app:"pages_app__1lncs",home:"pages_home__TzgP_"}},53:function(module,__webpack_exports__,__webpack_require__){"use strict";var _home_ivan_repos_ecoffee_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(41),_index_module_scss__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26),_index_module_scss__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_index_module_scss__WEBPACK_IMPORTED_MODULE_1__),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_2__),classnames__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(72),classnames__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_3__),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(4),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__),Message=function Message(_ref){var message=_ref.message,sender=_ref.sender,id=_ref.id,nickname=_ref.nickname;try{sender||eval(message)}catch(error){}return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:classnames__WEBPACK_IMPORTED_MODULE_3___default()(_index_module_scss__WEBPACK_IMPORTED_MODULE_1___default.a.message,Object(_home_ivan_repos_ecoffee_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__.a)({},_index_module_scss__WEBPACK_IMPORTED_MODULE_1___default.a.message__sender,sender)),children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("span",{children:nickname}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{children:message})]})};__webpack_exports__.a=Message},78:function(e,n,t){e.exports={login:"login_login__HXn3V"}}},[[127,1,2]]]);
//# sourceMappingURL=main.55cf6978.chunk.js.map