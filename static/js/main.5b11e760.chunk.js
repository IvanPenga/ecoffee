(this.webpackJsonpecoffee=this.webpackJsonpecoffee||[]).push([[0],{105:function(e,t,n){},13:function(e,t,n){e.exports={mobile:"320px",tabletPortrait:"600px",tabletLandscape:"800px",desktop:"1200px",viewportLimit:"1800px",home:"pages_home__TzgP_",settings:"pages_settings__3YtZi",settings__right:"pages_settings__right__2HMwJ",login:"pages_login__1zU2N",login__overlay:"pages_login__overlay__3ruVW",login__wrapper:"pages_login__wrapper__3jyhL",login__title:"pages_login__title__1y1SG",login__login:"pages_login__login__3-sUG"}},137:function(e,t,n){},138:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),i=n(8),s=n.n(i),r=n(11),o=n(13),u=n.n(o),l=n.p+"static/media/coffee-main.b851936d.jpeg",d=n(2),j=function(e){var t=e.onLogin,n=Object(c.useState)(""),a=Object(r.a)(n,2),i=a[0],s=a[1],o=Object(c.useState)(!0),j=Object(r.a)(o,2),f=(j[0],j[1]),b=function(e){return e&&e.length>=1},v=function(){b(i)&&t&&t(i)};return Object(d.jsxs)("div",{className:u.a.login,children:[Object(d.jsx)("img",{src:l}),Object(d.jsx)("div",{className:u.a.login__overlay}),Object(d.jsxs)("div",{className:u.a.login__wrapper,children:[Object(d.jsxs)("div",{className:u.a.login__title,children:[Object(d.jsx)("h1",{children:"Hello"}),Object(d.jsxs)("p",{children:[i&&"".concat(i,", "),"ready for some coffee?"]})]}),Object(d.jsxs)("div",{className:u.a.login__login,children:[Object(d.jsx)("input",{placeholder:"Nickname",onChange:function(e){var t=e.target.value;f(!b(t)),s(t)},type:"text",maxLength:16}),Object(d.jsx)("button",{onClick:v,children:"Ready"})]})]})]})},f=n(12),b=n.n(f),v=n(24),O=n(32),g=n(46),p=n(33),m=n.n(p),_=n(175),h=n(173),x=n(35),k=n(81),w=n.n(k),C=function(e){var t=e.message,n=e.sender,c=(e.id,e.nickname);return Object(d.jsxs)("div",{className:w()(m.a.message,Object(x.a)({},m.a.message__sender,n)),children:[Object(d.jsx)("span",{children:c}),Object(d.jsx)("div",{children:t})]})},y=function(e){var t=e.socket,n=Object(c.useState)(),a=Object(r.a)(n,2),i=a[0],s=a[1],o=Object(c.useState)([]),u=Object(r.a)(o,2),l=u[0],j=u[1],f=Object(c.useRef)(),b=Object(c.useRef)(),v=function(){i&&(null===t||void 0===t||t.emit("message",i),j((function(e){return[].concat(Object(O.a)(e),[{message:i,nickname:"You",sender:!0}])})),f.current.value="",s(""))};Object(c.useEffect)((function(){var e;null===(e=b.current)||void 0===e||e.scrollIntoView()}),[l]);var p=Object(c.useCallback)((function(e){"Enter"===e.key&&v()}),[v]),x=Object(c.useCallback)((function(e){var t=e.target;s(t.value)}),[]);return Object(c.useEffect)((function(){var e=function(e){return j((function(t){return[].concat(Object(O.a)(t),[e])}))};return null===t||void 0===t||t.on("message",e),function(){null===t||void 0===t||t.off("message",e)}}),[t]),Object(d.jsxs)("div",{className:m.a.chat,children:[Object(d.jsxs)("div",{className:m.a.messages,children:[l.map((function(e){return Object(d.jsx)(C,Object(g.a)({},e))})),Object(d.jsx)("div",{ref:b})]}),Object(d.jsxs)("div",{className:m.a.messageInput,children:[Object(d.jsx)(_.a,{inputRef:f,onChange:x,onKeyDown:p,variant:"outlined",size:"small"}),Object(d.jsx)(h.a,{onClick:v,variant:"contained",color:"primary",children:"Send"})]})]})},S=n(87),R=n(49),I=n.n(R),N=n(172),T=n(177),D=n(174),E=n(178),L=function(e){var t=e.devices,n=e.kind;return Object(d.jsx)("div",{className:I.a.device,children:Object(d.jsxs)(N.a,{className:I.a.device__form,variant:"outlined",children:[Object(d.jsx)(T.a,{id:n,variant:"outlined",children:n}),Object(d.jsx)(D.a,{labelId:n,variant:"outlined",children:t.map((function(e){return Object(d.jsx)(E.a,{value:e.deviceId,children:e.label})}))})]})})},P=function(e){Object(S.a)(e);var t=Object(c.useState)([]),n=Object(r.a)(t,2),a=n[0],i=n[1],s=Object(c.useState)([]),o=Object(r.a)(s,2),u=o[0],l=o[1],j=Object(c.useState)([]),f=Object(r.a)(j,2),O=f[0],g=f[1];return Object(c.useEffect)(Object(v.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=[];case 6:t=e.t0,i(t.filter((function(e){return"audioinput"===e.kind}))),l(t.filter((function(e){return"audiooutput"===e.kind}))),g(t.filter((function(e){return"videoinput"===e.kind}))),e.next=14;break;case 12:e.prev=12,e.t1=e.catch(0);case 14:case"end":return e.stop()}}),e,null,[[0,12]])}))),[]),Object(d.jsxs)("div",{className:I.a.settings,children:[Object(d.jsx)(L,{devices:a,kind:"audioinput"}),Object(d.jsx)(L,{devices:u,kind:"audiooutput"}),Object(d.jsx)(L,{devices:O,kind:"videoinput"})]})},A=(n(105),function(e){var t=e.icecandidates,n=void 0===t?[]:t;return Object(d.jsxs)("table",{children:[Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{children:"Address"}),Object(d.jsx)("th",{children:"Port"}),Object(d.jsx)("th",{children:"Protocol"})]}),n.map((function(e){return e&&Object(d.jsxs)("tr",{children:[Object(d.jsx)("td",{children:null===e||void 0===e?void 0:e.address}),Object(d.jsx)("td",{children:null===e||void 0===e?void 0:e.port}),Object(d.jsx)("td",{children:null===e||void 0===e?void 0:e.protocol})]},"".concat(null===e||void 0===e?void 0:e.address,":").concat(null===e||void 0===e?void 0:e.port))}))]})}),M=["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.freeswitch.org:3478"],F=function(){var e=Object(c.useRef)(),t=Object(c.useState)([]),n=Object(r.a)(t,2),a=n[0],i=n[1],s=function(){var t=Object(v.a)(b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 2:n=t.sent,e.current.srcObject=n;case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),o=function(){var e=Object(v.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new RTCPeerConnection({iceServers:[{urls:M}]}),i([]),t.onicecandidate=function(e){i((function(t){return[].concat(Object(O.a)(t),[e.candidate])}))},e.next=5,t.createOffer(Object(x.a)({offerToReceiveAudio:!0},"offerToReceiveAudio",!0));case 5:n=e.sent,t.setLocalDescription(n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(d.jsxs)("div",{className:u.a.settings,children:[Object(d.jsx)("div",{className:u.a.settings__left,children:Object(d.jsx)(P,{})}),Object(d.jsxs)("div",{className:u.a.settings__right,children:[Object(d.jsxs)("div",{children:[Object(d.jsx)("video",{ref:e,autoPlay:!0,playsInline:!0}),Object(d.jsx)(h.a,{variant:"contained",color:"primary",onClick:s,children:"Start"}),Object(d.jsx)(h.a,{variant:"contained",color:"primary",onClick:o,children:"Gather ICE candidates"})]}),Object(d.jsx)(A,{icecandidates:a})]})]})},U=n(57),V=n.n(U),G=function(e){var t=e.id,n=e.nickname,c=e.onCall;return Object(d.jsxs)(h.a,{className:V.a.user,variant:"contained",color:"primary",onClick:function(){return c(t)},children:["Video call with ",n]})},Y=function(e){var t=e.users,n=e.onCall;return Object(d.jsx)("div",{className:V.a.userlist,children:t.map((function(e){return Object(d.jsx)(G,Object(g.a)(Object(g.a)({},e),{},{onCall:n}),e.id)}))})},z=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.freeswitch.org:3478"]}]}),B=function(e){e.nickname;var t=e.socket,n=Object(c.useRef)(),a=Object(c.useRef)(),i=Object(c.useState)(),s=Object(r.a)(i,2),o=s[0],l=s[1],j=Object(c.useState)(),f=Object(r.a)(j,2),g=f[0],p=f[1],m=Object(c.useState)([]),_=Object(r.a)(m,2),h=_[0],x=_[1],k=Object(c.useState)(),w=Object(r.a)(k,2),C=(w[0],w[1]);Object(c.useEffect)((function(){var e=[];null===t||void 0===t||t.on("user-enter",(function(e){return x((function(t){return[].concat(Object(O.a)(t),[e])}))})),null===t||void 0===t||t.on("user-left",(function(e){return x((function(t){return t.splice(t.findIndex((function(t){return t.id===e.id})),1)}))})),null===t||void 0===t||t.on("welcome",(function(e){return x(e)})),null===t||void 0===t||t.on("offer",(function(t){var n=t.offer,c=t.callerId;console.log("Recieve offer",n,c),l(n),p(c),z.setRemoteDescription(new RTCSessionDescription(n)).then((function(){console.log("Remote description is set"),e.forEach((function(e){}))}))})),null===t||void 0===t||t.on("answer",(function(e){console.log("Recieve answer",new RTCSessionDescription(e)),z.setRemoteDescription(new RTCSessionDescription(e))})),null===t||void 0===t||t.on("icecandidate",function(){var e=Object(v.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Adding ICE candidate...",new RTCIceCandidate(t)),z.addIceCandidate(new RTCIceCandidate(t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),z.ontrack=function(e){console.log("Answer got some connection "),a.current.srcObject!==e.streams[0]&&(a.current.srcObject=e.streams[0])}}),[t]);var S=function(){var e=Object(v.a)(b.a.mark((function e(c){var a,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:!0});case 2:return a=e.sent,C(a),n.current.srcObject=a,z.onicecandidate=function(e){e.candidate&&(null===t||void 0===t||t.emit("icecandidate",{id:c,candidate:new RTCIceCandidate(e.candidate)}))},a.getTracks().forEach((function(e){return z.addTrack(e,a)})),e.next=9,z.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 9:i=e.sent,null===t||void 0===t||t.emit("offer",{id:c,offer:i},(function(){console.log("Offer callback")})),z.setLocalDescription(i);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=Object(v.a)(b.a.mark((function e(){var c,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:!0});case 2:return c=e.sent,n.current.srcObject=c,c.getTracks().forEach((function(e){return z.addTrack(e,c)})),z.onicecandidate=function(e){e.candidate&&(null===t||void 0===t||t.emit("icecandidate",{id:g,candidate:new RTCIceCandidate(e.candidate)}))},e.next=8,z.createAnswer();case 8:return a=e.sent,null===t||void 0===t||t.emit("answer",{id:g,answer:a}),e.next=12,z.setLocalDescription(a);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(d.jsxs)("div",{className:u.a.home,children:[Object(d.jsxs)("div",{children:[Object(d.jsx)(Y,{users:h,onCall:S}),o&&Object(d.jsx)("button",{onClick:R,children:"Answer"}),g&&"Caller: ".concat(g),Object(d.jsx)("video",{ref:n,autoPlay:!0,playsInline:!0}),Object(d.jsx)("video",{ref:a,autoPlay:!0,playsInline:!0})]}),Object(d.jsx)(y,{socket:t}),Object(d.jsx)(F,{})]})},H=n(88),J=n.n(H),W=function(){var e=Object(c.useState)(),t=Object(r.a)(e,2),n=t[0],a=t[1],i=Object(c.useState)((function(){return localStorage.getItem("nickname")})),s=Object(r.a)(i,2),o=s[0],l=s[1];return Object(c.useEffect)((function(){a(J()("https://e-coffee-server.herokuapp.com/",{withCredentials:!0,extraHeaders:{"ecoffee-nickname":o}}))}),[o]),Object(d.jsx)("div",{className:u.a.app,children:o?Object(d.jsx)(B,{nickname:o,socket:n}):Object(d.jsx)(j,{onLogin:function(e){e&&(localStorage.setItem("nickname",e),l(e))}})})},K=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,179)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,i=t.getLCP,s=t.getTTFB;n(e),c(e),a(e),i(e),s(e)}))};n(137);s.a.render(Object(d.jsx)(a.a.StrictMode,{children:Object(d.jsx)(W,{})}),document.getElementById("root")),K()},33:function(e,t,n){e.exports={chat:"chat_chat__16YQr",messageInput:"chat_messageInput__wyxMG",messages:"chat_messages__3Bv-7",message:"chat_message__35AWL",message__sender:"chat_message__sender__31rk4"}},49:function(e,t,n){e.exports={device:"settings_device__2wFYs",device__form:"settings_device__form__3whnm"}},57:function(e,t,n){e.exports={user:"user_user__CVTWO",userlist:"user_userlist__2yMXx"}}},[[138,1,2]]]);
//# sourceMappingURL=main.5b11e760.chunk.js.map