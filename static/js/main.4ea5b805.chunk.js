(this.webpackJsonpecoffee=this.webpackJsonpecoffee||[]).push([[0],{106:function(e,t,n){},138:function(e,t,n){},139:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),i=n(8),r=n.n(i),s=n(11),o=n(81),u=n.n(o),d=n(176),l=n(174),j=n(3),f=function(e){var t=e.onLogin,n=Object(c.useState)(),a=Object(s.a)(n,2),i=a[0],r=a[1],o=Object(c.useState)(!0),f=Object(s.a)(o,2),v=f[0],b=f[1],O=function(e){return e&&e.length>=1},m=function(){O(i)&&t&&t(i)};return Object(j.jsxs)("div",{className:u.a.login,children:[Object(j.jsx)(d.a,{onKeyDown:function(e){"Enter"===e.key&&m()},onChange:function(e){var t=e.target.value;b(!O(t)),r(t)},variant:"outlined",size:"small",label:"Nickname"}),Object(j.jsx)(l.a,{disabled:v,onClick:m,variant:"contained",color:"primary",children:"Enter"})]})},v=n(12),b=n.n(v),O=n(23),m=n(32),g=n(48),p=n(33),h=n.n(p),x=n(36),_=n(87),k=n.n(_),w=function(e){var t=e.message,n=e.sender,c=(e.id,e.nickname);return Object(j.jsxs)("div",{className:k()(h.a.message,Object(x.a)({},h.a.message__sender,n)),children:[Object(j.jsx)("span",{children:c}),Object(j.jsx)("div",{children:t})]})},C=function(e){var t=e.socket,n=Object(c.useState)(),a=Object(s.a)(n,2),i=a[0],r=a[1],o=Object(c.useState)([]),u=Object(s.a)(o,2),f=u[0],v=u[1],b=Object(c.useRef)(),O=Object(c.useRef)(),p=function(){i&&(null===t||void 0===t||t.emit("message",i),v((function(e){return[].concat(Object(m.a)(e),[{message:i,nickname:"You",sender:!0}])})),b.current.value="",r(""))};Object(c.useEffect)((function(){var e;null===(e=O.current)||void 0===e||e.scrollIntoView()}),[f]);var x=Object(c.useCallback)((function(e){"Enter"===e.key&&p()}),[p]),_=Object(c.useCallback)((function(e){var t=e.target;r(t.value)}),[]);return Object(c.useEffect)((function(){var e=function(e){return v((function(t){return[].concat(Object(m.a)(t),[e])}))};return null===t||void 0===t||t.on("message",e),function(){null===t||void 0===t||t.off("message",e)}}),[t]),Object(j.jsxs)("div",{className:h.a.chat,children:[Object(j.jsxs)("div",{className:h.a.messages,children:[f.map((function(e){return Object(j.jsx)(w,Object(g.a)({},e))})),Object(j.jsx)("div",{ref:O})]}),Object(j.jsxs)("div",{className:h.a.messageInput,children:[Object(j.jsx)(d.a,{inputRef:b,onChange:_,onKeyDown:x,variant:"outlined",size:"small"}),Object(j.jsx)(l.a,{onClick:p,variant:"contained",color:"primary",children:"Send"})]})]})},S=n(88),R=n(49),y=n.n(R),I=n(173),T=n(178),D=n(175),N=n(179),E=function(e){var t=e.devices,n=e.kind;return Object(j.jsx)("div",{className:y.a.device,children:Object(j.jsxs)(I.a,{className:y.a.device__form,variant:"outlined",children:[Object(j.jsx)(T.a,{id:n,variant:"outlined",children:n}),Object(j.jsx)(D.a,{labelId:n,variant:"outlined",children:t.map((function(e){return Object(j.jsx)(N.a,{value:e.deviceId,children:e.label})}))})]})})},P=function(e){Object(S.a)(e);var t=Object(c.useState)([]),n=Object(s.a)(t,2),a=n[0],i=n[1],r=Object(c.useState)([]),o=Object(s.a)(r,2),u=o[0],d=o[1],l=Object(c.useState)([]),f=Object(s.a)(l,2),v=f[0],m=f[1];return Object(c.useEffect)(Object(O.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=[];case 6:t=e.t0,i(t.filter((function(e){return"audioinput"===e.kind}))),d(t.filter((function(e){return"audiooutput"===e.kind}))),m(t.filter((function(e){return"videoinput"===e.kind}))),e.next=14;break;case 12:e.prev=12,e.t1=e.catch(0);case 14:case"end":return e.stop()}}),e,null,[[0,12]])}))),[]),Object(j.jsxs)("div",{className:y.a.settings,children:[Object(j.jsx)(E,{devices:a,kind:"audioinput"}),Object(j.jsx)(E,{devices:u,kind:"audiooutput"}),Object(j.jsx)(E,{devices:v,kind:"videoinput"})]})},A=(n(106),function(e){var t=e.icecandidates,n=void 0===t?[]:t;return Object(j.jsxs)("table",{children:[Object(j.jsxs)("tr",{children:[Object(j.jsx)("th",{children:"Address"}),Object(j.jsx)("th",{children:"Port"}),Object(j.jsx)("th",{children:"Protocol"})]}),n.map((function(e){return e&&Object(j.jsxs)("tr",{children:[Object(j.jsx)("td",{children:null===e||void 0===e?void 0:e.address}),Object(j.jsx)("td",{children:null===e||void 0===e?void 0:e.port}),Object(j.jsx)("td",{children:null===e||void 0===e?void 0:e.protocol})]},"".concat(null===e||void 0===e?void 0:e.address,":").concat(null===e||void 0===e?void 0:e.port))}))]})}),L=n(27),M=n.n(L),F=["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.freeswitch.org:3478"],V=function(){var e=Object(c.useRef)(),t=Object(c.useState)([]),n=Object(s.a)(t,2),a=n[0],i=n[1],r=function(){var t=Object(O.a)(b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 2:n=t.sent,e.current.srcObject=n;case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),o=function(){var e=Object(O.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new RTCPeerConnection({iceServers:[{urls:F}]}),i([]),t.onicecandidate=function(e){i((function(t){return[].concat(Object(m.a)(t),[e.candidate])}))},e.next=5,t.createOffer(Object(x.a)({offerToReceiveAudio:!0},"offerToReceiveAudio",!0));case 5:n=e.sent,t.setLocalDescription(n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(j.jsxs)("div",{className:M.a.settings,children:[Object(j.jsx)("div",{className:M.a.settings__left,children:Object(j.jsx)(P,{})}),Object(j.jsxs)("div",{className:M.a.settings__right,children:[Object(j.jsxs)("div",{children:[Object(j.jsx)("video",{ref:e,autoPlay:!0,playsInline:!0}),Object(j.jsx)(l.a,{variant:"contained",color:"primary",onClick:r,children:"Start"}),Object(j.jsx)(l.a,{variant:"contained",color:"primary",onClick:o,children:"Gather ICE candidates"})]}),Object(j.jsx)(A,{icecandidates:a})]})]})},Y=n(57),z=n.n(Y),B=function(e){var t=e.id,n=e.nickname,c=e.onCall;return Object(j.jsxs)(l.a,{className:z.a.user,variant:"contained",color:"primary",onClick:function(){return c(t)},children:["Video call with ",n]})},H=function(e){var t=e.users,n=e.onCall;return Object(j.jsx)("div",{className:z.a.userlist,children:t.map((function(e){return Object(j.jsx)(B,Object(g.a)(Object(g.a)({},e),{},{onCall:n}),e.id)}))})},J=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.freeswitch.org:3478"]}]}),U=function(e){e.nickname;var t=e.socket,n=Object(c.useRef)(),a=Object(c.useRef)(),i=Object(c.useState)(),r=Object(s.a)(i,2),o=r[0],u=r[1],d=Object(c.useState)(),l=Object(s.a)(d,2),f=l[0],v=l[1],g=Object(c.useState)([]),p=Object(s.a)(g,2),h=p[0],x=p[1],_=Object(c.useState)(),k=Object(s.a)(_,2),w=(k[0],k[1]);Object(c.useEffect)((function(){var e=[];null===t||void 0===t||t.on("user-enter",(function(e){return x((function(t){return[].concat(Object(m.a)(t),[e])}))})),null===t||void 0===t||t.on("user-left",(function(e){return x((function(t){return t.splice(t.findIndex((function(t){return t.id===e.id})),1)}))})),null===t||void 0===t||t.on("welcome",(function(e){return x(e)})),null===t||void 0===t||t.on("offer",(function(t){var n=t.offer,c=t.callerId;console.log("Recieve offer",n,c),u(n),v(c),J.setRemoteDescription(new RTCSessionDescription(n)).then((function(){console.log("Remote description is set"),e.forEach((function(e){}))}))})),null===t||void 0===t||t.on("answer",(function(e){console.log("Recieve answer",new RTCSessionDescription(e)),J.setRemoteDescription(new RTCSessionDescription(e))})),null===t||void 0===t||t.on("icecandidate",function(){var e=Object(O.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Adding ICE candidate...",new RTCIceCandidate(t)),J.addIceCandidate(new RTCIceCandidate(t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),J.ontrack=function(e){console.log("Answer got some connection "),a.current.srcObject!==e.streams[0]&&(a.current.srcObject=e.streams[0])}}),[t]);var S=function(){var e=Object(O.a)(b.a.mark((function e(c){var a,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:!0});case 2:return a=e.sent,w(a),n.current.srcObject=a,J.onicecandidate=function(e){e.candidate&&(null===t||void 0===t||t.emit("icecandidate",{id:c,candidate:new RTCIceCandidate(e.candidate)}))},a.getTracks().forEach((function(e){return J.addTrack(e,a)})),e.next=9,J.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 9:i=e.sent,null===t||void 0===t||t.emit("offer",{id:c,offer:i},(function(){console.log("Offer callback")})),J.setLocalDescription(i);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=Object(O.a)(b.a.mark((function e(){var c,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:!0});case 2:return c=e.sent,n.current.srcObject=c,c.getTracks().forEach((function(e){return J.addTrack(e,c)})),J.onicecandidate=function(e){e.candidate&&(null===t||void 0===t||t.emit("icecandidate",{id:f,candidate:new RTCIceCandidate(e.candidate)}))},e.next=8,J.createAnswer();case 8:return a=e.sent,null===t||void 0===t||t.emit("answer",{id:f,answer:a}),e.next=12,J.setLocalDescription(a);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(j.jsxs)("div",{className:M.a.home,children:[Object(j.jsxs)("div",{children:[Object(j.jsx)(H,{users:h,onCall:S}),o&&Object(j.jsx)("button",{onClick:R,children:"Answer"}),f&&"Caller: ".concat(f),Object(j.jsx)("video",{ref:n,autoPlay:!0,playsInline:!0}),Object(j.jsx)("video",{ref:a,autoPlay:!0,playsInline:!0})]}),Object(j.jsx)(C,{socket:t}),Object(j.jsx)(V,{})]})},G=n(89),K=n.n(G),W=function(){var e=Object(c.useState)(),t=Object(s.a)(e,2),n=t[0],a=t[1],i=Object(c.useState)((function(){return localStorage.getItem("nickname")})),r=Object(s.a)(i,2),o=r[0],u=r[1];return Object(c.useEffect)((function(){a(K()("https://e-coffee-server.herokuapp.com/",{withCredentials:!0,extraHeaders:{"ecoffee-nickname":o}}))}),[o]),Object(j.jsx)("div",{className:M.a.app,children:o?Object(j.jsx)(U,{nickname:o,socket:n}):Object(j.jsx)(f,{onLogin:function(e){e&&(localStorage.setItem("nickname",e),u(e))}})})},X=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,180)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),i(e),r(e)}))};n(138);r.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(W,{})}),document.getElementById("root")),X()},27:function(e,t,n){e.exports={app:"pages_app__1lncs",home:"pages_home__TzgP_",settings:"pages_settings__3YtZi",settings__right:"pages_settings__right__2HMwJ"}},33:function(e,t,n){e.exports={chat:"chat_chat__16YQr",messageInput:"chat_messageInput__wyxMG",messages:"chat_messages__3Bv-7",message:"chat_message__35AWL",message__sender:"chat_message__sender__31rk4"}},49:function(e,t,n){e.exports={device:"settings_device__2wFYs",device__form:"settings_device__form__3whnm"}},57:function(e,t,n){e.exports={user:"user_user__CVTWO",userlist:"user_userlist__2yMXx"}},81:function(e,t,n){e.exports={login:"login_login__HXn3V"}}},[[139,1,2]]]);
//# sourceMappingURL=main.4ea5b805.chunk.js.map