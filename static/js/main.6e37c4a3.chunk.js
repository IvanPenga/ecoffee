(this.webpackJsonpecoffee=this.webpackJsonpecoffee||[]).push([[0],{125:function(e,n,t){},126:function(e,n,t){"use strict";t.r(n);var c=t(0),a=t.n(c),r=t(8),s=t.n(r),i=t(33),o=t(37),u=t(11),l=t(25),d=t.n(l),f=t(156),j=t(157),b=t(41),O=t(72),v=t.n(O),m=t(5),p=function(e){var n=e.message,t=e.sender,c=(e.id,e.nickname);return Object(m.jsxs)("div",{className:v()(d.a.message,Object(b.a)({},d.a.message__sender,t)),children:[Object(m.jsx)("span",{children:c}),Object(m.jsx)("div",{children:n})]})},g=function(e){var n=e.socket,t=Object(c.useState)(),a=Object(u.a)(t,2),r=a[0],s=a[1],l=Object(c.useState)([]),b=Object(u.a)(l,2),O=b[0],v=b[1],g=Object(c.useRef)(),h=Object(c.useRef)(),x=function(){r&&(null===n||void 0===n||n.emit("message",r),v((function(e){return[].concat(Object(o.a)(e),[{message:r,nickname:"You",sender:!0}])})),g.current.value="",s(""))};Object(c.useEffect)((function(){var e;null===(e=h.current)||void 0===e||e.scrollIntoView()}),[O]);var _=Object(c.useCallback)((function(e){"Enter"===e.key&&x()}),[x]),k=Object(c.useCallback)((function(e){var n=e.target;s(n.value)}),[]);return Object(c.useEffect)((function(){var e=function(e){return v((function(n){return[].concat(Object(o.a)(n),[e])}))};return null===n||void 0===n||n.on("message",e),function(){null===n||void 0===n||n.off("message",e)}}),[n]),Object(m.jsxs)("div",{className:d.a.chat,children:[Object(m.jsxs)("div",{className:d.a.messages,children:[O.map((function(e){return Object(m.jsx)(p,Object(i.a)({},e))})),Object(m.jsx)("div",{ref:h})]}),Object(m.jsxs)("div",{className:d.a.messageInput,children:[Object(m.jsx)(f.a,{inputRef:g,onChange:k,onKeyDown:_,variant:"outlined",size:"small"}),Object(m.jsx)(j.a,{onClick:x,variant:"contained",color:"primary",children:"Send"})]})]})},h=t(78),x=t.n(h),_=function(e){var n=e.onLogin,t=Object(c.useState)(),a=Object(u.a)(t,2),r=a[0],s=a[1],i=Object(c.useState)(!0),o=Object(u.a)(i,2),l=o[0],d=o[1],b=function(e){return e&&e.length>=1},O=function(){b(r)&&n&&n(r)};return Object(m.jsxs)("div",{className:x.a.login,children:[Object(m.jsx)(f.a,{onKeyDown:function(e){"Enter"===e.key&&O()},onChange:function(e){var n=e.target.value;d(!b(n)),s(n)},variant:"outlined",size:"small",label:"Nickname"}),Object(m.jsx)(j.a,{disabled:l,onClick:O,variant:"contained",color:"primary",children:"Enter"})]})},k=t(26),C=t.n(k),w=t(48),R=t(45),I=t.n(R),S=function(e){var n=e.id,t=e.nickname,c=e.onCall;return Object(m.jsxs)(j.a,{className:I.a.user,variant:"contained",color:"primary",onClick:function(){return c(n)},children:["Video call with ",t]})},y=function(e){var n=e.users,t=e.onCall;return Object(m.jsx)("div",{className:I.a.userlist,children:n.map((function(e){return Object(m.jsx)(S,Object(i.a)(Object(i.a)({},e),{},{onCall:t}),e.id)}))})},T=t(46),D=t.n(T),E=new RTCPeerConnection({iceServers:[{urls:"stun:stun.1.google.com:19302"}]}),N=function(e){e.nickname;var n=e.socket,t=Object(c.useRef)(),a=Object(c.useRef)(),r=Object(c.useState)(),s=Object(u.a)(r,2),i=s[0],l=s[1],d=Object(c.useState)(),f=Object(u.a)(d,2),j=f[0],b=f[1],O=Object(c.useState)([]),v=Object(u.a)(O,2),p=v[0],h=v[1],x=Object(c.useState)(),_=Object(u.a)(x,2),k=(_[0],_[1]);Object(c.useEffect)((function(){var e=[];null===n||void 0===n||n.on("user-enter",(function(e){return h((function(n){return[].concat(Object(o.a)(n),[e])}))})),null===n||void 0===n||n.on("user-left",(function(e){return h((function(n){return n.splice(n.findIndex((function(n){return n.id===e.id})),1)}))})),null===n||void 0===n||n.on("welcome",(function(e){return h(e)})),null===n||void 0===n||n.on("offer",(function(n){var t=n.offer,c=n.callerId;console.log("Recieve offer",t,c),l(t),b(c),E.setRemoteDescription(new RTCSessionDescription(t)).then((function(){console.log("Remote description is set"),e.forEach((function(e){}))}))})),null===n||void 0===n||n.on("answer",(function(e){console.log("Recieve answer",new RTCSessionDescription(e)),E.setRemoteDescription(new RTCSessionDescription(e))})),null===n||void 0===n||n.on("icecandidate",function(){var e=Object(w.a)(C.a.mark((function e(n){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Adding ICE candidate...",new RTCIceCandidate(n)),E.addIceCandidate(new RTCIceCandidate(n));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),E.ontrack=function(e){console.log("Answer got some connection "),a.current.srcObject!==e.streams[0]&&(a.current.srcObject=e.streams[0])}}),[n]);var R=function(){var e=Object(w.a)(C.a.mark((function e(c){var a,r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:!0});case 2:return a=e.sent,k(a),t.current.srcObject=a,E.ontrack=function(){console.log("I got some tracks!")},E.onicecandidate=function(e){e.candidate&&(null===n||void 0===n||n.emit("icecandidate",{id:c,candidate:new RTCIceCandidate(e.candidate)}))},a.getTracks().forEach((function(e){return E.addTrack(e,a)})),e.next=10,E.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 10:r=e.sent,null===n||void 0===n||n.emit("offer",{id:c,offer:r},(function(){console.log("Offer callback")})),E.setLocalDescription(r);case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),I=function(){var e=Object(w.a)(C.a.mark((function e(){var t;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.onicecandidate=function(e){e.candidate&&(null===n||void 0===n||n.emit("icecandidate",{id:j,candidate:new RTCIceCandidate(e.candidate)}))},e.next=3,E.createAnswer();case 3:return t=e.sent,null===n||void 0===n||n.emit("answer",{id:j,answer:t}),e.next=7,E.setLocalDescription(t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(m.jsxs)("div",{className:D.a.home,children:[Object(m.jsxs)("div",{children:[Object(m.jsx)(y,{users:p,onCall:R}),i&&Object(m.jsx)("button",{onClick:I,children:"Answer"}),j&&"Caller: ".concat(j),Object(m.jsx)("video",{ref:t,autoPlay:!0,playsInline:!0}),Object(m.jsx)("video",{ref:a,autoPlay:!0,playsInline:!0})]}),Object(m.jsx)(g,{socket:n})]})},L=t(79),A=t.n(L),P=function(){var e=Object(c.useState)(),n=Object(u.a)(e,2),t=n[0],a=n[1],r=Object(c.useState)((function(){return localStorage.getItem("nickname")})),s=Object(u.a)(r,2),i=s[0],o=s[1];return Object(c.useEffect)((function(){a(A()("https://e-coffee-server.herokuapp.com/",{withCredentials:!0,extraHeaders:{"ecoffee-nickname":i}}))}),[i]),Object(m.jsx)("div",{className:D.a.app,children:i?Object(m.jsx)(N,{nickname:i,socket:t}):Object(m.jsx)(_,{onLogin:function(e){e&&(localStorage.setItem("nickname",e),o(e))}})})},V=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,159)).then((function(n){var t=n.getCLS,c=n.getFID,a=n.getFCP,r=n.getLCP,s=n.getTTFB;t(e),c(e),a(e),r(e),s(e)}))};t(125);s.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(P,{})}),document.getElementById("root")),V()},25:function(e,n,t){e.exports={chat:"chat_chat__16YQr",messageInput:"chat_messageInput__wyxMG",messages:"chat_messages__3Bv-7",message:"chat_message__35AWL",message__sender:"chat_message__sender__31rk4"}},45:function(e,n,t){e.exports={user:"user_user__CVTWO",userlist:"user_userlist__2yMXx"}},46:function(e,n,t){e.exports={app:"pages_app__1lncs",home:"pages_home__TzgP_"}},78:function(e,n,t){e.exports={login:"login_login__HXn3V"}}},[[126,1,2]]]);
//# sourceMappingURL=main.6e37c4a3.chunk.js.map